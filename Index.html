<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfect Circle Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black; /* Black background */
            color: white;
        }
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }
        .score {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <div class="score" id="score">Draw a circle!</div>
    <canvas id="circleCanvas"></canvas>
    <script>
        const canvas = document.getElementById("circleCanvas");
        const ctx = canvas.getContext("2d");
        const scoreDiv = document.getElementById("score");
        let drawing = false;
        let points = [];
        let highScore = 0;
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);
        
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const minDistance = 30; // Set a small minimum distance from the center
        
        function drawCenterDot() {
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);
            ctx.fill();
        }

        function isTooClose(x, y) {
            const distFromCenter = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
            return distFromCenter < minDistance;
        }
        
        canvas.addEventListener("mousedown", (e) => {
            if (isTooClose(e.clientX, e.clientY)) {
                scoreDiv.innerText = "Too close to the dot!";
                return;
            }
            drawing = true;
            points = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawCenterDot();
        });

        canvas.addEventListener("mousemove", (e) => {
            if (!drawing) return;

            if (isTooClose(e.clientX, e.clientY)) {
                // Prevent drawing if too close to the center
                return;
            }

            points.push({ x: e.clientX, y: e.clientY });
            ctx.strokeStyle = "white";
            ctx.lineWidth = 2;
            if (points.length > 1) {
                ctx.beginPath();
                ctx.moveTo(points[points.length - 2].x, points[points.length - 2].y);
                ctx.lineTo(e.clientX, e.clientY);
                ctx.stroke();
            }
        });

        canvas.addEventListener("mouseup", () => {
            drawing = false;
            evaluateCircle();
        });

        function evaluateCircle() {
            if (points.length < 10) return;
            let minX = Math.min(...points.map(p => p.x));
            let maxX = Math.max(...points.map(p => p.x));
            let minY = Math.min(...points.map(p => p.y));
            let maxY = Math.max(...points.map(p => p.y));
            let width = maxX - minX;
            let height = maxY - minY;
            let avgRadius = (width + height) / 4;
            
            let deviations = points.map(p => {
                let dist = Math.sqrt((p.x - centerX) ** 2 + (p.y - centerY) ** 2);
                return Math.abs(dist - avgRadius);
            });
            let avgDeviation = deviations.reduce((sum, d) => sum + d, 0) / deviations.length;
            
            let stability = Math.max(0, 100 - avgDeviation * 1.5); // Made less strict
            let score = Math.round(stability + 5); // Increased score to be more forgiving
            
            ctx.strokeStyle = "yellow";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, avgRadius, 0, Math.PI * 2);
            ctx.stroke();
            
            if (score > 90) {
                scoreDiv.style.backgroundColor = "green";
                scoreDiv.style.color = "white";
            } else if (score > 70) {
                scoreDiv.style.backgroundColor = "yellow";
                scoreDiv.style.color = "black";
            } else {
                scoreDiv.style.backgroundColor = "red";
                scoreDiv.style.color = "white";
            }
            
            if (score > highScore) {
                highScore = score;
                scoreDiv.innerText = `Score: ${score}% - NEW HIGH SCORE!`;
            } else {
                scoreDiv.innerText = `Score: ${score}%`;
            }
        }

        drawCenterDot();
    </script>
</body>
</html>
