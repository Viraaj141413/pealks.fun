<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfect Circle Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }
        .score {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            text-align: center;
        }
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="score" id="score">Draw a circle!</div>
    <div class="instructions" id="instructions">Click and drag to draw a circle around the dot.</div>
    <canvas id="circleCanvas"></canvas>
    <script>
        const canvas = document.getElementById("circleCanvas");
        const ctx = canvas.getContext("2d");
        const scoreDiv = document.getElementById("score");
        const instructionsDiv = document.getElementById("instructions");
        let drawing = false;
        let points = [];
        let highScore = 0;
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);
        
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const minDistance = 50; // Minimum distance from the center
        
        function drawCenterDot() {
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);
            ctx.fill();
        }
        
        canvas.addEventListener("mousedown", (e) => {
            const distFromCenter = Math.sqrt((e.clientX - centerX) ** 2 + (e.clientY - centerY) ** 2);
            if (distFromCenter < minDistance) {
                scoreDiv.innerText = "Too close to the dot!";
                return;
            }
            drawing = true;
            points = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawCenterDot();
        });

        canvas.addEventListener("mousemove", (e) => {
            if (!drawing) return;
            points.push({ x: e.clientX, y: e.clientY });
            ctx.strokeStyle = "white";
            ctx.lineWidth = 2;
            if (points.length > 1) {
                ctx.beginPath();
                ctx.moveTo(points[points.length - 2].x, points[points.length - 2].y);
                ctx.lineTo(e.clientX, e.clientY);
                ctx.stroke();
            }
        });

        canvas.addEventListener("mouseup", () => {
            drawing = false;
            evaluateCircle();
        });

        function evaluateCircle() {
            if (points.length < 10) {
                scoreDiv.innerText = "Draw a full circle!";
                return;
            }

            // Check if the shape is a scribble (too irregular)
            let isScribble = false;
            let angleChanges = [];
            for (let i = 1; i < points.length - 1; i++) {
                let dx1 = points[i].x - points[i - 1].x;
                let dy1 = points[i].y - points[i - 1].y;
                let dx2 = points[i + 1].x - points[i].x;
                let dy2 = points[i + 1].y - points[i].y;
                let angle = Math.atan2(dy2, dx2) - Math.atan2(dy1, dx1);
                angleChanges.push(Math.abs(angle));
            }
            let avgAngleChange = angleChanges.reduce((sum, a) => sum + a, 0) / angleChanges.length;
            if (avgAngleChange > 1.5) { // Threshold for scribble detection
                isScribble = true;
            }

            // Check if the shape is a line (not a circle)
            let minX = Math.min(...points.map(p => p.x));
            let maxX = Math.max(...points.map(p => p.x));
            let minY = Math.min(...points.map(p => p.y));
            let maxY = Math.max(...points.map(p => p.y));
            let width = maxX - minX;
            let height = maxY - minY;
            let aspectRatio = width / height;
            if (aspectRatio < 0.5 || aspectRatio > 2) { // Threshold for line detection
                isScribble = true;
            }

            if (isScribble) {
                scoreDiv.innerText = "That's a scribble, not a circle!";
                return;
            }

            // Calculate circle properties
            let avgRadius = (width + height) / 4;
            let deviations = points.map(p => {
                let dist = Math.sqrt((p.x - centerX) ** 2 + (p.y - centerY) ** 2);
                return Math.abs(dist - avgRadius);
            });
            let avgDeviation = deviations.reduce((sum, d) => sum + d, 0) / deviations.length;
            let stability = Math.max(0, 100 - avgDeviation * 1.5); // Made less strict
            let score = Math.round(stability + 5); // Increased score to be more forgiving
            
            // Draw the ideal circle for comparison
            ctx.strokeStyle = "yellow";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, avgRadius, 0, Math.PI * 2);
            ctx.stroke();
            
            // Update score display
            if (score > 90) {
                scoreDiv.style.backgroundColor = "green";
                scoreDiv.style.color = "white";
            } else if (score > 70) {
                scoreDiv.style.backgroundColor = "yellow";
                scoreDiv.style.color = "black";
            } else {
                scoreDiv.style.backgroundColor = "red";
                scoreDiv.style.color = "white";
            }
            
            if (score > highScore) {
                highScore = score;
                scoreDiv.innerText = `Score: ${score}% - NEW HIGH SCORE!`;
            } else {
                scoreDiv.innerText = `Score: ${score}%`;
            }
        }

        drawCenterDot();
    </script>
</body>
</html>
